# Font Dedup - TTF å­—ä½“ Glyph å»é‡å·¥å…·

ä¸€ä¸ªç”¨äºåˆ†æå’Œä¼˜åŒ– TTF å­—ä½“æ–‡ä»¶çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œé€šè¿‡æ™ºèƒ½å»é‡å‡å°å­—ä½“æ–‡ä»¶æ€»ä½“ç§¯ã€‚

## åŠŸèƒ½ç‰¹ç‚¹

- ğŸ” **å­—ä½“åˆ†æ**: åˆ†æå¤šä¸ªå­—ä½“æ–‡ä»¶ä¸­çš„ glyph é‡å¤æƒ…å†µ
- ğŸ¯ **ä¼˜å…ˆçº§å»é‡**: æ ¹æ®ç”¨æˆ·æŒ‡å®šçš„ä¼˜å…ˆçº§ä¿ç•™ glyph
- ğŸ¨ **å­—å½¢æ£€æµ‹**: æ™ºèƒ½è¯†åˆ«ç›¸åŒ Unicode ç ç‚¹çš„å­—å½¢å˜ä½“ï¼ˆå¦‚ CJK å­—ç¬¦çš„åœ°åŒºå·®å¼‚ï¼‰
- ğŸ“Š **Unicode èŒƒå›´è¿‡æ»¤**: æ”¯æŒæŒ‡å®šç‰¹å®š Unicode èŒƒå›´è¿›è¡Œå»é‡
- ğŸ›¡ï¸ **æ’é™¤èŒƒå›´ä¿æŠ¤**: ä¿æŠ¤ç‰¹å®šèŒƒå›´çš„ glyph ä¸è¢«å»é‡
- âœ… **è‡ªåŠ¨éªŒè¯**: éªŒè¯ç”Ÿæˆçš„å­—ä½“æ–‡ä»¶æœ‰æ•ˆæ€§
- ğŸ‡¨ğŸ‡³ **ä¸­æ–‡ç•Œé¢**: è¾“å‡ºæŠ¥å‘Šå’Œé”™è¯¯ä¿¡æ¯ä½¿ç”¨ä¸­æ–‡

## å®‰è£…

```bash
pip install -e .
```

å¼€å‘æ¨¡å¼å®‰è£…ï¼ˆåŒ…å«æµ‹è¯•ä¾èµ–ï¼‰ï¼š

```bash
pip install -e ".[dev]"
```

## ä½¿ç”¨æ–¹æ³•

### åˆ†æå­—ä½“æ–‡ä»¶

ä»…åˆ†æå­—ä½“æ–‡ä»¶ä¸­çš„é‡å¤ glyphï¼Œä¸ä¿®æ”¹ä»»ä½•æ–‡ä»¶ï¼š

```bash
font-dedup analyze font1.ttf font2.ttf font3.ttf
```

å¯ç”¨å­—å½¢æ£€æµ‹åˆ†æï¼ˆè¯†åˆ«å­—å½¢å˜ä½“ï¼‰ï¼š

```bash
font-dedup analyze NotoSansSC-Bold.ttf NotoSansKR-Bold.ttf --shape-analysis
```

é™åˆ¶å­—å½¢åˆ†æçš„å­—ç¬¦æ•°é‡ï¼ˆåŠ å¿«åˆ†æé€Ÿåº¦ï¼‰ï¼š

```bash
font-dedup analyze font1.ttf font2.ttf --shape-analysis --codepoint-limit 100
```

### æ‰§è¡Œå»é‡

åŸºæœ¬å»é‡æ“ä½œï¼š

```bash
font-dedup deduplicate font1.ttf font2.ttf -o ./output
```

æŒ‡å®šå­—ä½“ä¼˜å…ˆçº§ï¼ˆfont1.ttf ä¼˜å…ˆçº§æœ€é«˜ï¼‰ï¼š

```bash
font-dedup deduplicate font1.ttf font2.ttf -o ./output -p font1.ttf
```

ä»…å¤„ç†ä¸­æ–‡å­—ç¬¦èŒƒå›´ï¼š

```bash
font-dedup deduplicate font1.ttf font2.ttf -o ./output -r 0x4E00-0x9FFF
```

æ’é™¤ ASCII å­—ç¬¦èŒƒå›´ï¼š

```bash
font-dedup deduplicate font1.ttf font2.ttf -o ./output -e 0x0020-0x007F
```

è‡ªå®šä¹‰è¾“å‡ºæ–‡ä»¶åç¼€ï¼š

```bash
font-dedup deduplicate font1.ttf font2.ttf -o ./output -s _optimized
```

å¯ç”¨å­—å½¢æ£€æµ‹å»é‡ï¼ˆä¿æŠ¤å­—å½¢å˜ä½“ï¼‰ï¼š

```bash
font-dedup deduplicate NotoSansSC-Bold.ttf NotoSansKR-Bold.ttf -o ./output --shape-analysis
```

è‡ªå®šä¹‰å­—å½¢ç›¸ä¼¼åº¦é˜ˆå€¼ï¼ˆé»˜è®¤ 1.0ï¼Œå³å®Œå…¨ç›¸åŒï¼‰ï¼š

```bash
font-dedup deduplicate font1.ttf font2.ttf -o ./output --shape-analysis --similarity-threshold 0.95
```

## å·¥ä½œåŸç†

1. **è§£æå­—ä½“**: ä½¿ç”¨ fonttools è§£æ TTF æ–‡ä»¶ï¼Œæå– glyph å’Œ Unicode æ˜ å°„ä¿¡æ¯
2. **æ£€æµ‹é‡å¤**: åˆ†æå¤šä¸ªå­—ä½“é—´çš„ code point é‡å æƒ…å†µ
3. **å­—å½¢åˆ†æ**ï¼ˆå¯é€‰ï¼‰: æå–å­—å½¢è½®å»“æ•°æ®ï¼Œè®¡ç®—ç›¸ä¼¼åº¦ï¼Œè¯†åˆ«å­—å½¢å˜ä½“
4. **ä¼˜å…ˆçº§å»é‡**: æ ¹æ®ä¼˜å…ˆçº§é¡ºåºï¼Œä»ä½ä¼˜å…ˆçº§å­—ä½“ä¸­ç§»é™¤é‡å¤ glyph
5. **ç”Ÿæˆå­—ä½“**: ä½¿ç”¨ fonttools subsetting åŠŸèƒ½ç”Ÿæˆä¼˜åŒ–åçš„å­—ä½“æ–‡ä»¶
6. **éªŒè¯è¾“å‡º**: éªŒè¯ç”Ÿæˆçš„å­—ä½“æ–‡ä»¶æ ¼å¼æ­£ç¡®ä¸”æ‰€æœ‰ä¿ç•™çš„ glyph å¯è®¿é—®

### å­—å½¢æ£€æµ‹åŠŸèƒ½

å­—å½¢æ£€æµ‹åŠŸèƒ½ä¸“é—¨ç”¨äºå¤„ç† CJKï¼ˆä¸­æ—¥éŸ©ï¼‰å­—ä½“ç­‰å­˜åœ¨åœ°åŒºå­—å½¢å·®å¼‚çš„åœºæ™¯ã€‚ç›¸åŒçš„ Unicode ç ç‚¹åœ¨ä¸åŒåœ°åŒºå¯èƒ½æœ‰ä¸åŒçš„å­—å½¢è®¾è®¡ï¼š

- **ç®€ä½“ä¸­æ–‡ (SC)** vs **éŸ©æ–‡ (KR)**: è®¸å¤šæ±‰å­—æœ‰ä¸åŒçš„ç¬”ç”»é£æ ¼
- **æ—¥æ–‡ (JP)** vs **ç¹ä½“ä¸­æ–‡ (TC)**: éƒ¨åˆ†æ±‰å­—çš„å†™æ³•å­˜åœ¨å·®å¼‚

å¯ç”¨å­—å½¢æ£€æµ‹åï¼Œå·¥å…·ä¼šï¼š

1. æå–æ¯ä¸ªå­—ç¬¦çš„è½®å»“æ•°æ®
2. è®¡ç®—å­—å½¢ç›¸ä¼¼åº¦ï¼ˆé»˜è®¤ä½¿ç”¨ä¸¥æ ¼ç›¸ç­‰æ£€æŸ¥ï¼‰
3. è¯†åˆ«å­—å½¢å˜ä½“å¹¶åœ¨æ‰€æœ‰å­—ä½“ä¸­ä¿ç•™
4. ä»…å»é‡çœŸæ­£ç›¸åŒçš„å­—å½¢

**æ€§èƒ½è¯´æ˜**: å­—å½¢åˆ†æéœ€è¦æå–å’Œæ¯”è¾ƒè½®å»“æ•°æ®ï¼Œå¯¹äºåŒ…å«æ•°åƒå­—ç¬¦çš„ CJK å­—ä½“å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ã€‚å»ºè®®ï¼š
- é¦–æ¬¡åˆ†ææ—¶ä½¿ç”¨ `--codepoint-limit` å‚æ•°å¿«é€Ÿè¯„ä¼°
- ä½¿ç”¨ `--range` å‚æ•°é™åˆ¶åˆ†æèŒƒå›´
- å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œå¯ä»¥ç¼“å­˜åˆ†æç»“æœ

## ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1: åŸºæœ¬å»é‡

å‡è®¾ä½ æœ‰ä¸‰ä¸ªå­—ä½“æ–‡ä»¶ï¼Œæƒ³è¦å»é™¤é‡å¤çš„ glyphï¼š

```bash
# åˆ†æé‡å¤æƒ…å†µ
font-dedup analyze NotoSans-Regular.ttf NotoSans-Light.ttf

# æ‰§è¡Œå»é‡ï¼ˆNotoSans-Regular.ttf ä¼˜å…ˆçº§æ›´é«˜ï¼‰
font-dedup deduplicate NotoSans-Regular.ttf NotoSans-Light.ttf -o ./output -p NotoSans-Regular.ttf
```

### ç¤ºä¾‹ 2: CJK å­—ä½“å­—å½¢æ£€æµ‹

å¤„ç†ä¸­æ—¥éŸ©å­—ä½“æ—¶ï¼Œå¯ç”¨å­—å½¢æ£€æµ‹ä»¥ä¿æŠ¤åœ°åŒºå­—å½¢å·®å¼‚ï¼š

```bash
# åˆ†æå­—å½¢å˜ä½“
font-dedup analyze NotoSansSC-Bold.ttf NotoSansKR-Bold.ttf --shape-analysis --codepoint-limit 50

# æ‰§è¡Œå­—å½¢æ£€æµ‹å»é‡
font-dedup deduplicate NotoSansSC-Bold.ttf NotoSansKR-Bold.ttf -o ./output --shape-analysis
```

### ç¤ºä¾‹ 3: ä»…å¤„ç†ä¸­æ–‡å­—ç¬¦èŒƒå›´

åªå¯¹ CJK ç»Ÿä¸€è¡¨æ„æ–‡å­—è¿›è¡Œå»é‡ï¼š

```bash
font-dedup deduplicate font1.ttf font2.ttf -o ./output -r 0x4E00-0x9FFF
```

### ç¤ºä¾‹ 4: ä¿æŠ¤ ASCII å­—ç¬¦

å»é‡æ—¶ä¿æŠ¤ ASCII å­—ç¬¦ä¸è¢«åˆ é™¤ï¼š

```bash
font-dedup deduplicate font1.ttf font2.ttf -o ./output -e 0x0020-0x007F
```

## æŠ€æœ¯æ ˆ

- **Python 3.10+**
- **fonttools**: å­—ä½“æ–‡ä»¶è§£æå’Œå¤„ç†ï¼ˆåŒ…æ‹¬è½®å»“æ•°æ®æå–ï¼‰
- **click**: å‘½ä»¤è¡Œæ¥å£
- **pytest + hypothesis**: å•å…ƒæµ‹è¯•å’Œå±æ€§æµ‹è¯•æ¡†æ¶

## å¼€å‘

### è·å–æµ‹è¯•å­—ä½“

æµ‹è¯•éœ€è¦ä½¿ç”¨ TTF å­—ä½“æ–‡ä»¶ã€‚ä½ å¯ä»¥ä» [Google Fonts](https://fonts.google.com/) ä¸‹è½½ Noto Sans ç³»åˆ—å­—ä½“ï¼š

- [Noto Sans JP](https://fonts.google.com/noto/specimen/Noto+Sans+JP)
- [Noto Sans KR](https://fonts.google.com/noto/specimen/Noto+Sans+KR)
- [Noto Sans SC](https://fonts.google.com/noto/specimen/Noto+Sans+SC)

å°†ä¸‹è½½çš„ TTF æ–‡ä»¶æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•å³å¯è¿è¡Œæµ‹è¯•ã€‚

### è¿è¡Œæµ‹è¯•

è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼ˆä¸åŒ…æ‹¬æ…¢é€Ÿ CJK æµ‹è¯•ï¼‰ï¼š

```bash
pytest -m "not cjk"
```

è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼ˆåŒ…æ‹¬ CJK å­—å½¢æ£€æµ‹æµ‹è¯•ï¼‰ï¼š

```bash
pytest
```

ä»…è¿è¡Œ CJK å­—å½¢æ£€æµ‹æµ‹è¯•ï¼š

```bash
pytest -m cjk
```

è¿è¡Œæµ‹è¯•å¹¶æŸ¥çœ‹è¦†ç›–ç‡ï¼š

```bash
pytest --cov=src/font_dedup
```

**æ³¨æ„**: CJK å­—å½¢æ£€æµ‹æµ‹è¯•éœ€è¦è¾ƒé•¿æ—¶é—´ï¼ˆ1-2 åˆ†é’Ÿï¼‰ï¼Œå› ä¸ºéœ€è¦åˆ†æå¤§å‹å­—ä½“æ–‡ä»¶çš„è½®å»“æ•°æ®ã€‚

## é¡¹ç›®ç»“æ„

```
font-dedup/
â”œâ”€â”€ src/font_dedup/
â”‚   â”œâ”€â”€ analyzer.py          # å­—ä½“åˆ†æå™¨
â”‚   â”œâ”€â”€ shape_analyzer.py    # å­—å½¢åˆ†æå™¨ï¼ˆè½®å»“æå–å’Œç›¸ä¼¼åº¦è®¡ç®—ï¼‰
â”‚   â”œâ”€â”€ engine.py            # å»é‡å¼•æ“ï¼ˆæ”¯æŒå­—å½¢æ£€æµ‹ï¼‰
â”‚   â”œâ”€â”€ generator.py         # å­—ä½“ç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ validator.py         # éªŒè¯å™¨
â”‚   â”œâ”€â”€ reporter.py          # æŠ¥å‘Šç”Ÿæˆå™¨ï¼ˆæ”¯æŒå­—å½¢å˜ä½“æŠ¥å‘Šï¼‰
â”‚   â”œâ”€â”€ models.py            # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ cli.py               # å‘½ä»¤è¡Œæ¥å£
â”‚   â””â”€â”€ utils.py             # å·¥å…·å‡½æ•°
â”œâ”€â”€ tests/                   # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ test_cjk_fonts.py    # CJK å­—ä½“æµ‹è¯•ï¼ˆæ ‡è®°ä¸ºæ…¢é€Ÿæµ‹è¯•ï¼‰
â”‚   â””â”€â”€ test_shape_detection_integration.py  # å­—å½¢æ£€æµ‹é›†æˆæµ‹è¯•
â”œâ”€â”€ .kiro/specs/             # åŠŸèƒ½è§„æ ¼æ–‡æ¡£
â””â”€â”€ pyproject.toml           # é¡¹ç›®é…ç½®
```

## è®¸å¯è¯

### é¡¹ç›®ä»£ç 

æœ¬é¡¹ç›®ä»£ç ä½¿ç”¨ MIT Licenseã€‚

### æµ‹è¯•å­—ä½“

æµ‹è¯•ä½¿ç”¨çš„ Noto Sans å­—ä½“æ–‡ä»¶ï¼ˆä½äº `fonts/` ç›®å½•å’Œé¡¹ç›®æ ¹ç›®å½•ï¼‰ä½¿ç”¨ **SIL Open Font License (OFL) 1.1**ã€‚

- **ç‰ˆæƒæ‰€æœ‰**: The Noto Project Authors
- **æ¥æº**: https://fonts.google.com/noto
- **è®¸å¯è¯è¯¦æƒ…**: è¯·å‚é˜… `fonts/OFL.txt`

è¿™äº›å­—ä½“æ–‡ä»¶ä»…ç”¨äºæµ‹è¯•ç›®çš„ï¼Œä¸åŒ…å«åœ¨è½¯ä»¶åˆ†å‘åŒ…ä¸­ã€‚

## ä½œè€…

hellsge (hellsge@qq.com)
